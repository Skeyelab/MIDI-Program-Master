<html>
<head>
	<title>Program Change Monitor</title>
	<script src="https://cdn.jsdelivr.net/npm/webmidi"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
	<link rel="mask-icon" href="images/safari-pinned-tab.svg" color="#5bbad5">
</head>
<body>
	<script type="text/javascript">
	
	var settings = {};
	for (i = 1; i <= 16; i++) {
		settings["channel"+i]= {
			"bankselectcourse": null,
			"bankselectfine": null,
			"programchange": null
		};
	}

// Enable WebMidi.js
	WebMidi.enable(function(err) {
		if (err) {
		console.log("WebMidi could not be enabled.", err);
		} else {
			init();
		}
		
		
	});
	
	function init() {
		createListeners();
		updateSettingsDisplay();
	}

	function updateSettingsDisplay(){
		$("#settings").text(JSON.stringify(settings, null, 1))
	}

	function createListeners() {
		WebMidi.inputs.forEach(input => {
	
			// Listen to control change message on all channels
			input.addListener("controlchange", "all", function(e) {
				switch (e.controller.name) {
				case "bankselectcoarse":
					
					console.log(`Updating MSB for ch: ${e.channel} to ${e.value}`);
					$(`#bankselectcoarse_${e.channel}`).text(e.value);
					settings["channel"+e.channel]["bankselectcourse"] = e.value;
					updateSettingsDisplay();
					break;
				case "bankselectfine":
					
					console.log(`Updating LSB for ch: ${e.channel} to ${e.value}`);
					$(`#bankselectfine_${e.channel}`).text(e.value);
					settings["channel"+e.channel]["bankselectfine"] = e.value;
					updateSettingsDisplay();
					break;
				default:
					console.log("Received 'controlchange' message.", e);
				}
			});
	
			input.addListener("programchange", "all", function(e) {
				$(`#pc_${e.channel}`).text(e.value);
				settings["channel"+e.channel]["programchange"] = e.value;
				updateSettingsDisplay();
				console.log(`Updating PC for ch: ${e.channel} to ${e.value}`);
			});
		});
	}

	</script>

	<h1>Program Change Monitor</h1>
	<p id="intro">
		What is this?  This is a browser based MIDI Program Change monitor.  <br/>
		It should display program change data for all available MIDI inputs in real time.  <br/><br/>
		It uses <a href="http://djipco.github.io/webmidi/latest/classes/WebMidi.html">WebMidi.js</a> and is running 100% in your browser. You can read the code on <a href="https://github.com/Skeyelab/MIDI-Program-Master">GitHub</a> if you like.
	</p>
	<div class="divTable">
		<div class="divTableBody">
			<div class="divTableRow">
				<div class="divTableCell"></div>
				<div class="divTableCell">1</div>
				<div class="divTableCell">2</div>
				<div class="divTableCell">3</div>
				<div class="divTableCell">4</div>
				<div class="divTableCell">5</div>
				<div class="divTableCell">6</div>
				<div class="divTableCell">7</div>
				<div class="divTableCell">8</div>
				<div class="divTableCell">9</div>
				<div class="divTableCell">10</div>
				<div class="divTableCell">11</div>
				<div class="divTableCell">12</div>
				<div class="divTableCell">13</div>
				<div class="divTableCell">14</div>
				<div class="divTableCell">15</div>
				<div class="divTableCell">16</div>
			</div>
			<div class="divTableRow">
				<div class="divTableCell">MSB</div>
				<div class="divTableCell" id="bankselectcoarse_1"></div>
				<div class="divTableCell" id="bankselectcoarse_2"></div>
				<div class="divTableCell" id="bankselectcoarse_3"></div>
				<div class="divTableCell" id="bankselectcoarse_4"></div>
				<div class="divTableCell" id="bankselectcoarse_5"></div>
				<div class="divTableCell" id="bankselectcoarse_6"></div>
				<div class="divTableCell" id="bankselectcoarse_7"></div>
				<div class="divTableCell" id="bankselectcoarse_8"></div>
				<div class="divTableCell" id="bankselectcoarse_9"></div>
				<div class="divTableCell" id="bankselectcoarse_10"></div>
				<div class="divTableCell" id="bankselectcoarse_11"></div>
				<div class="divTableCell" id="bankselectcoarse_12"></div>
				<div class="divTableCell" id="bankselectcoarse_13"></div>
				<div class="divTableCell" id="bankselectcoarse_14"></div>
				<div class="divTableCell" id="bankselectcoarse_15"></div>
				<div class="divTableCell" id="bankselectcoarse_16"></div>
			</div>
			<div class="divTableRow">
				<div class="divTableCell">LSB</div>
				<div class="divTableCell" id="bankselectfine_1"></div>
				<div class="divTableCell" id="bankselectfine_2"></div>
				<div class="divTableCell" id="bankselectfine_3"></div>
				<div class="divTableCell" id="bankselectfine_4"></div>
				<div class="divTableCell" id="bankselectfine_5"></div>
				<div class="divTableCell" id="bankselectfine_6"></div>
				<div class="divTableCell" id="bankselectfine_7"></div>
				<div class="divTableCell" id="bankselectfine_8"></div>
				<div class="divTableCell" id="bankselectfine_9"></div>
				<div class="divTableCell" id="bankselectfine_10"></div>
				<div class="divTableCell" id="bankselectfine_11"></div>
				<div class="divTableCell" id="bankselectfine_12"></div>
				<div class="divTableCell" id="bankselectfine_13"></div>
				<div class="divTableCell" id="bankselectfine_14"></div>
				<div class="divTableCell" id="bankselectfine_15"></div>
				<div class="divTableCell" id="bankselectfine_16"></div>
			</div>
			<div class="divTableRow">
				<div class="divTableCell">PC</div>
				<div class="divTableCell" id="pc_1"></div>
				<div class="divTableCell" id="pc_2"></div>
				<div class="divTableCell" id="pc_3"></div>
				<div class="divTableCell" id="pc_4"></div>
				<div class="divTableCell" id="pc_5"></div>
				<div class="divTableCell" id="pc_6"></div>
				<div class="divTableCell" id="pc_7"></div>
				<div class="divTableCell" id="pc_8"></div>
				<div class="divTableCell" id="pc_9"></div>
				<div class="divTableCell" id="pc_10"></div>
				<div class="divTableCell" id="pc_11"></div>
				<div class="divTableCell" id="pc_12"></div>
				<div class="divTableCell" id="pc_13"></div>
				<div class="divTableCell" id="pc_14"></div>
				<div class="divTableCell" id="pc_15"></div>
				<div class="divTableCell" id="pc_16"></div>
			</div>
		</div>
	</div>
	<p id="reportBugs">
		Please report bugs here: <a href="https://github.com/Skeyelab/MIDI-Program-Master/issues">https://github.com/Skeyelab/MIDI-Program-Master/issues</a>
	</p>
	<hr>
	<p>Settings as JSON</p>
	<pre id="settings">

	</pre>
<!-- DivTable.com -->
<!-- DivTable.com -->


</html>